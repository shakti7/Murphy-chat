{"ast":null,"code":"import { createBroker } from 'broker-factory';\nimport { addUniqueNumber } from 'fast-unique-numbers';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\nconst encoderIds = new Set();\nexport const wrap = createBroker({\n  encode: ({\n    call\n  }) => {\n    return async (encoderId, timeslice) => {\n      const arrayBuffers = await call('encode', {\n        encoderId,\n        timeslice\n      });\n      encoderIds.delete(encoderId);\n      return arrayBuffers;\n    };\n  },\n  instantiate: ({\n    call\n  }) => {\n    return async (mimeType, sampleRate) => {\n      const encoderId = addUniqueNumber(encoderIds);\n      const port = await call('instantiate', {\n        encoderId,\n        mimeType,\n        sampleRate\n      });\n      return {\n        encoderId,\n        port\n      };\n    };\n  },\n  register: ({\n    call\n  }) => {\n    return port => {\n      return call('register', {\n        port\n      }, [port]);\n    };\n  }\n});\nexport const load = url => {\n  const worker = new Worker(url);\n  return wrap(worker);\n};","map":{"version":3,"names":["createBroker","addUniqueNumber","encoderIds","Set","wrap","encode","call","encoderId","timeslice","arrayBuffers","delete","instantiate","mimeType","sampleRate","port","register","load","url","worker","Worker"],"sources":["D:\\OneDrive\\Desktop\\testProject\\my-app\\node_modules\\media-encoder-host-broker\\src\\module.ts"],"sourcesContent":["import { createBroker } from 'broker-factory';\nimport { addUniqueNumber } from 'fast-unique-numbers';\nimport { TMediaEncoderHostWorkerDefinition } from 'media-encoder-host-worker';\nimport { IMediaEncoderHostBrokerDefinition } from './interfaces';\nimport { TMediaEncoderHostBrokerLoader, TMediaEncoderHostBrokerWrapper } from './types';\n\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\n\nconst encoderIds: Set<number> = new Set();\n\nexport const wrap: TMediaEncoderHostBrokerWrapper = createBroker<IMediaEncoderHostBrokerDefinition, TMediaEncoderHostWorkerDefinition>({\n    encode: ({ call }) => {\n        return async (encoderId, timeslice) => {\n            const arrayBuffers = await call('encode', { encoderId, timeslice });\n\n            encoderIds.delete(encoderId);\n\n            return arrayBuffers;\n        };\n    },\n    instantiate: ({ call }) => {\n        return async (mimeType, sampleRate) => {\n            const encoderId = addUniqueNumber(encoderIds);\n            const port = await call('instantiate', { encoderId, mimeType, sampleRate });\n\n            return { encoderId, port };\n        };\n    },\n    register: ({ call }) => {\n        return (port) => {\n            return call('register', { port }, [port]);\n        };\n    }\n});\n\nexport const load: TMediaEncoderHostBrokerLoader = (url: string) => {\n    const worker = new Worker(url);\n\n    return wrap(worker);\n};\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,gBAAgB;AAC7C,SAASC,eAAe,QAAQ,qBAAqB;AAKrD;;;;AAIA,cAAc,oBAAoB;AAClC,cAAc,eAAe;AAE7B,MAAMC,UAAU,GAAgB,IAAIC,GAAG,EAAE;AAEzC,OAAO,MAAMC,IAAI,GAAmCJ,YAAY,CAAuE;EACnIK,MAAM,EAAEA,CAAC;IAAEC;EAAI,CAAE,KAAI;IACjB,OAAO,OAAOC,SAAS,EAAEC,SAAS,KAAI;MAClC,MAAMC,YAAY,GAAG,MAAMH,IAAI,CAAC,QAAQ,EAAE;QAAEC,SAAS;QAAEC;MAAS,CAAE,CAAC;MAEnEN,UAAU,CAACQ,MAAM,CAACH,SAAS,CAAC;MAE5B,OAAOE,YAAY;IACvB,CAAC;EACL,CAAC;EACDE,WAAW,EAAEA,CAAC;IAAEL;EAAI,CAAE,KAAI;IACtB,OAAO,OAAOM,QAAQ,EAAEC,UAAU,KAAI;MAClC,MAAMN,SAAS,GAAGN,eAAe,CAACC,UAAU,CAAC;MAC7C,MAAMY,IAAI,GAAG,MAAMR,IAAI,CAAC,aAAa,EAAE;QAAEC,SAAS;QAAEK,QAAQ;QAAEC;MAAU,CAAE,CAAC;MAE3E,OAAO;QAAEN,SAAS;QAAEO;MAAI,CAAE;IAC9B,CAAC;EACL,CAAC;EACDC,QAAQ,EAAEA,CAAC;IAAET;EAAI,CAAE,KAAI;IACnB,OAAQQ,IAAI,IAAI;MACZ,OAAOR,IAAI,CAAC,UAAU,EAAE;QAAEQ;MAAI,CAAE,EAAE,CAACA,IAAI,CAAC,CAAC;IAC7C,CAAC;EACL;CACH,CAAC;AAEF,OAAO,MAAME,IAAI,GAAmCC,GAAW,IAAI;EAC/D,MAAMC,MAAM,GAAG,IAAIC,MAAM,CAACF,GAAG,CAAC;EAE9B,OAAOb,IAAI,CAACc,MAAM,CAAC;AACvB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}